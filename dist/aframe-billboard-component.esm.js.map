{"version":3,"file":"aframe-billboard-component.esm.js","sources":["../src/aframe-billboard-component.ts"],"sourcesContent":["  declare const AFRAME:any, THREE:any\n\n/**** (re)define a component for A-Frame ****/\n\n  delete AFRAME.components['billboard']\n\n  AFRAME.registerComponent('billboard', {\n    dependencies: ['camera'],\n    schema: {\n      'map':   { type:'map' },\n      'width': { type:'number' },\n      'height':{ type:'number' }\n    },\n\n  /**** init ****/\n\n    init: function ():void {\n      this.Texture  = undefined\n      this.Material = new THREE.MeshBasicMaterial({\n        transparent:true, alphaTest:0.5\n      })\n      this.Mesh  = new THREE.Mesh(new THREE.PlaneGeometry(1,1),this.Material)\n      this.Group = new THREE.Group()\n        this.Group.add(this.Mesh)\n      this.el.setObject3D('mesh',this.Group)\n\n      this.Origin = new THREE.Vector3()\n      this.Target = new THREE.Vector3()\n    }, // will invoke \"update\" next\n\n  /**** update ****/\n\n    update: function (oldData:any):void {\n      if (\n        (oldData == null) || (oldData.map == null) ||\n        (oldData.map !== this.data.map)\n      ) {\n        if (this.Texture != null) { this.Texture.dispose() }\n\n        let newMap = this.data.map\n        this.Texture = new THREE.TextureLoader().load(\n          newMap instanceof Image ? newMap.src : newMap,\n          (Texture:any) => {\n            this.Material.map         = Texture\n            this.Material.needsUpdate = true\n\n            updateSizeOf(this)\n          }\n        )\n      }\n\n      if (\n        (oldData == null) ||\n        (oldData.width  !== this.data.width) ||\n        (oldData.height !== this.data.height)\n      ) {\n        updateSizeOf(this)\n      }\n    },\n\n  /**** tick ****/\n\n    tick: function ():void {\n      let Camera = this.el.sceneEl.getObject3D('camera')\n      Camera.getWorldPosition(this.Target)\n\n      this.Group.getWorldPosition(this.Origin)\n      this.Target.setY(this.Origin.y)\n\n      this.Group.lookAt(this.Target)\n    },\n\n  /**** remove ****/\n\n    remove: function ():void {\n      if (this.Mesh     != null) { this.el.removeObject3D('mesh') }\n      if (this.Texture  != null) { this.Texture.dispose() }\n      if (this.Material != null) { this.Material.dispose() }\n    }\n  })\n\n/**** updateSizeOf ****/\n\n  function updateSizeOf (Billboard:any):void {\n    let Width  = Billboard.data.width\n    let Height = Billboard.data.height\n\n    if ((Width === 0) && (Height === 0)) { Height = 1 }\n\n    if ((Width === 0) || (Height === 0)) {\n      let Texture = Billboard.Texture\n      if (\n        (Texture != null) && (Texture.image != null) &&\n        Texture.image.complete &&\n        (Texture.image.naturalWidth !== 0) && (Texture.image.naturalHeight !== 0)\n      ) {\n        let AspectRatio = Texture.image.naturalWidth / Texture.image.naturalHeight\n        if (Width === 0) {\n          Width = Height * AspectRatio\n        } else {\n          Height = Width / AspectRatio\n        }\n      }\n    }\n\n    Billboard.Mesh.scale.set(Width,Height,1)\n    Billboard.Mesh.position.set(0,Height/2,0) // affected by scale!\n  }\n\n"],"names":[],"mappings":"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"}